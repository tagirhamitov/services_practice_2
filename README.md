# Практика 2: Мафия

## Реализована функциональность на 10 баллов

Код написан на языке Go.

Код клиента в директории `mafia_client`. Внутри есть директории `manual` и `automatic` - для ручного клиента и бота.

Код сервера в директории `mafia_server`.

Proto-схема в директории `proto`.

Получение сообщений от сервера реализовано через server-side streaming. Клиенты получают объект потока сообщений при подключении к игре.

## Запуск
Следующая команда запускает сервер и трех ботов через `docker-compose`:
```shell
$ docker-compose up --build
```
Количество ботов можно изменить, модифицировав файл `docker-compose.yml`

Чтобы открыть четвертого ручного клиента, нужно собрать образ и запустить:
```shell
$ docker build . -f mafia_client.dockerfile -t mafia_client
$ docker run -it --net=host mafia_client
```

После этого клиен попросит ввести имя пользователя и адрес сервера (по умолчанию нужно ввести `:9000`).

Альтернативно, четвертого клиента можно также запустить в автоматическом режиме:
```shell
$ docker run --net=host mafia_client --auto --username USERNAME --server SERVER
```
где вместо `USERNAME` нужно подставить любое имя пользователя, а вместо `SERVER` - адрес сервера (по умолчанию нужно ввести `:9000`).

## Управление

Команды вводятся в терминале текстом на английском языке.

В дневное время доступны команды:
- `finish_day` - завершить день. Когда все живые игроки завершат день, время суток сменится на ночь.
- `kill USERNAME` - проголосовать за убийство игрока. Вместо `USERNAME` нужно указать ник игрока, за убийство которого вы голосуете. Если против одного игрока наберется большинство голосов среди живых, его убьют.
- `publish_mafia USERNAME` - опубликовать мафию (для комиссара). Все игроки получат сообщение об этом.

В ночное время доступны команды:
- `kill USERNAME` - убить игрока (для мафии). Игрок становится мертвым.
- `check_mafia USERNAME` - проверить игрока (для комиссара). Если игрок является мафией, комиссар об этом узнает.

## Боты

Боты играют в автоматическом режиме, при этом выводя в логи свои действия.

Если мафия была опубликована комиссаром, боты будут голосовать за ее убийство. Иначе с вероятностью 50% они в течение дня выбирают случайного живого игрока и голосуют за его убийство.

Ночью мафия убивает случайного игрока, а комиссар проверяет случайного игрока.

## Ручной клиент

Пока не наберется достаточное количество игроков, клиент ждет в лобби, при этом видя сообщения о подключающихся и отключающихся игроках. Чтобы отключиться, достаточно завершить процесс (например, нажав `Ctrl+C`).

Когда в лобби набирается 4 игрока, начинается сессия. Игроки получают об этом сообщение вместе с ID сессии, своей ролью и списком участников.

Сессия завершается при победе мирных жителей или мафии.
